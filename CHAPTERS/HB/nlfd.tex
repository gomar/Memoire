%!TEX root = ../../adrien_gomar_phd.tex

\paragraph{Mono-frequential formulation}

Originally proposed by \citet{McMullen2001}, the NLFD
method relies on a simple observation: to develop spectral methods, and in
particular the NLH method, one has made use of the Fourier
series to efficiently represent an unsteady signal.
This representation is then used to compute the unsteady
equation by converting it into $2N+1$ steady equations coupled by a 
source term where $N$ is small.
However, the method needs to be resolved in the frequency domain meaning
that all the numerical techniques should be adapted: the numerical schemes,
the turbulent models and so on. The smart idea 
proposed by \citet{McMullen2001} is to
make use of the Fast Fourier Transform and its inverse to
make it easy to implement in a classical time-domain code.
To explain the development of this method, let us first 
write Eq.~\ref{eq:sm_nonlinear_convection_conservative} 
in a more general form:
\begin{equation}
	\frac{\partial u}{\partial t} + R = 0,
	\label{eq:sm_nonlinear_convection_residual}
\end{equation}
with
\begin{equation}
	R = \frac{\partial}{\partial x} \left( 
	\frac{u^2}{2} \right).
\end{equation}
Let us now consider that both $u$ and $R$ are periodic
in time with respect to period $T = 2 \pi / \omega$
and can be written using a Fourier series:
\begin{equation}
	\begin{split}
		u(t) &= \sum_{k=-\infty}^{\infty} \widehat{u}_k e^{i k \omega t}, \\
		R(t) &= \sum_{k=-\infty}^{\infty} \widehat{R}_k e^{i k \omega t}.
	\end{split}
\end{equation}
Note that decomposing $R(t)$ into a Fourier series is equivalent
to use the Fourier decomposition of $u(t)$ and express
$R(t)$ using the Fourier coefficients $\widehat{u}_k$ of $u$
since the cross-terms that may arise are also expressed 
using the same complex exponentials. This comes from the fact
that multiplying a complex exponential with a complex exponential
just forms a new complex exponential at the power of the sum of the
two.
Injecting these decompositions into 
Eq.~\ref{eq:sm_nonlinear_convection_residual} and taking into account
for the orthogonality of the complex exponentials:
\begin{equation}
	i k \omega \widehat{u}_k + \widehat{R}_k = 0, \: k \in [-\infty, \infty].
\end{equation}
As previously, only a small number of harmonic $N$ is kept and 
a pseudo-time ($\tau$) derivative is added to march the equations
in pseudo-time to the steady-state solutions of all the harmonics:
\begin{equation}
	\fbox{$
	\displaystyle \frac{\partial \widehat{u}_k}{\partial \tau} + 
	i k \omega \widehat{u}_k + \widehat{R}_k = 0, \: k \in [-N, N].
	$}
	\label{eq:sm_nlfd_subset_eq}
\end{equation}
The fact that $R(t)$ is expressed using its own Fourier series 
makes it simpler to implement 
as it avoid developing its expression using 
the complex coefficients $\widehat{u}_k$.
However, $\widehat{R}_k$ must be evaluated. To do so, as depicted
in Fig.~\ref{fig:nlfd_principle}, \citet{McMullen2001}
propose to use an Inverse Fast-Fourier Transform (IFFT) to get
$u(t)$ from $\widehat{u}_k$. Then the considered governing equation
is used to evaluate $R(t)$ which leads to $\widehat{R}_k$
through a Fast-Fourier Transform (FFT). Finally, the next iteration value 
$\widehat{u}_k$
is evaluated by adding $\widehat{R}_k$ and 
the corresponding temporal derivative $i k \omega \widehat{u}_k$. All
harmonics are coupled through the IFFT and FFT operations
that needs all of them to compute the counterpart temporal signal,
hence the coupling.
\begin{figure}[htbp]
  \centering
  \includegraphics*[width=0.50\textwidth]{nlfd_principle.pdf}
  \caption{Simplified diagram of the computation of $\widehat{R}_k$ from $\widehat{u}_k$
  for the non-linear frequency domain method}
  \label{fig:nlfd_principle}
\end{figure}

\paragraph{Extension to the Navier-Stokes equations}
The Navier-Stokes equations can be written in finite-volume,
semi-discrete form as:
\begin{equation}
	V \frac{\partial W}{\partial t} + R(W) = 0,
	\label{eq:navier_stokes_fv_sd}
\end{equation}
where $V$ is the volume of the cell and $W$
the vector of conservative variables.
This formulation is similar to
Eq.~\ref{eq:sm_nonlinear_convection_residual} meaning that
nothing particular has to be made to derive this approach for
the Navier-Stokes equations. This is indeed very attractive as the
method can be applied almost directly, except for the FFT and IFFT
step that should be added into the time loop.

\paragraph{Time line}
\begin{figure}[htbp]
  \centering
  \includegraphics*[scale=0.5]{timeline_nlfd.pdf}
  \caption{Time line for the non-linear frequency domain method}
  \label{fig:timeline_nlfd}
\end{figure}
Figure~\ref{fig:timeline_nlfd} shows the time line of the
development of the NLFD method.
The method was first introduced by \citet{McMullen2001}
at Stanford University and applied to the two-dimensional
Navier-Stokes equations. It has been validated against an
unsteady channel flow that admits an analytical 
solution~\cite{Merkle1987} and applied to a cylinder
vortex shedding. This could be done as the frequency of the
vortex shedding was known \emph{a priori} from experimental
and numerical data. However, for a given cylinder, it is not
possible to know this frequency. This is why
 \citet{McMullen2002, McMullen2006a}
proposed a gradient based method for determining the frequency
of a periodic phenomena where the frequency is unknown
\emph{a priori}. They argue that the frequency domain formulation
helps forming a gradient operator to find the period $T$ based
on the minimization of the residual of the unsteady equations.
They applied their algorithm to find the frequency of the vortex
shedding around a cylinder.
\citet{Nadarajah2003} compared an optimum shape design for 
airfoils undergoing a change 
in angle of attack as a function of time 
using both a classical time-marching scheme
and the NLFD approach. It is shown that the NLFD method
gives the same accuracy for the gradient and the optimum with only 
three time-instants (corresponding to a one-harmonic computation)
compared to $23$ time-instants needed for 
the time-marching approach.
\citet{McMullen2006} detail all the acceleration techniques
that can be used with the NLFD method such as multigrid, local
time-stepping, residual averaging, coarse grid spectral viscosity,
proving that a steady-state convergence rate can be obtained.
\citet{Nadarajah2007} extended the optimum shape design 
using the NLFD to three-dimensional wings undergoing a change 
in angle of attack as a function of time. It is demonstrated that
five instants (namely two harmonics) is sufficient to provide
accuracy of the approach.
\citet{Kachra2008} extended the approach to the strong coupling of
aero-elasticity within the two-dimensional Euler equations framework.
They demonstrate that with a one-harmonic NLFD computation, the
flutter boundary of a NACA$64A010$ airfoil is correctly predicted.
This leads to a gain of one order of magnitude compared to a classical
time-marching procedure. Both the fluid dynamics and the structural equations
are solved using the NLFD approach. Moreover they quantitatively estimate the
cost of the FFT and IFFT done at each time-loop of the NLFD approach as
approximately $2\%$ of the cost of one iteration, which is small.


\paragraph{Cost of the method}
The NLFD method is close to the NLH approach in terms of number
of equation solved. However, at each time-step a fast Fourier transform
is performed to cast back the harmonics into the time-domain in order
to compute the residual $R(t)$. \citet{McMullen2006} argue
that the cost of the fast Fourier transform is less than the cost of 
the spatial derivatives, and is thus negligible.
Based on this affirmation, one can say that equivalent to the NLH
approach, if $\mathdollar_{\text{RANS}}$ 
denotes the CPU and memory cost of
one steady computation, the cost of the NLFD method can be 
approximated by:
\begin{equation}
	\mathdollar_{\text{NLFD}} = (2N+1) \cdot \mathdollar_{\text{RANS}}
\end{equation}